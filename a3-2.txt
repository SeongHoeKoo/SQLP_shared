/* 
다음의 SQL을 같은 Data을 증복해서 읽지 않도록 개선하세요.
필요한 인덱스는 모두 구성되었다는 가정 
*/

정답1)
SELECT ORDER_NO, ORDER_CD
    ,  ROUND(AVG(ORDER_AMT) OVER(PARTITION BY ORDER_CD)) 평균주문금액
    ,  SUM(ORDER_AMT)       OVER(PARTITION BY ORDER_CD)        주문합계금액
FROM T_ORDER42
ORDER BY ORDER_CD, ORDER_NO
;

정답2) -- ORDER BY 절 생략 : 불필요한 정렬 제거
SELECT ORDER_NO, ORDER_CD, ORDER_DT, ORDER_AMT
FROM (
    SELECT ORDER_NO, ORDER_CD, ORDER_DT, ORDER_AMT
        ,  ROW_NUMBER() OVER (PARTITION BY ORDER_CD ORDER BY ORDER_NO DESC) ORDER_ROW_NO
    FROM T_ORDER42 
    )
WHERE ORDER_ROW_NO = 1
;
